#!/bin/sh

set -e

case "$1" in
    configure)
        
	# Set permissions
	chmod +x /var/www/capme/.scripts/cliscript*
	chown www-data:www-data /var/www/capme/pcap

	# If timezone.php doesn't exist, create it
	[ -f /var/www/capme/.inc/timezone.php ] || cp /var/www/capme/.inc/timezone.php.sample /var/www/capme/.inc/timezone.php

	# Disable Indexes in Apache config
	FILE="/etc/apache2/sites-available/default-ssl"
	if grep "Options Indexes FollowSymLinks MultiViews" $FILE >/dev/null 2>&1 ; then
		sed -i 's|Options Indexes FollowSymLinks MultiViews|Options FollowSymLinks MultiViews|g' $FILE || echo "Unable to update $FILE"
		if pgrep -lf apache2 >/dev/null 2>&1 ; then
			service apache2 restart || echo "Unable to restart Apache"
		fi
	fi
        
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;


    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
